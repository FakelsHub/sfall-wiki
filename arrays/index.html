<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Массивы (Arrays) - sfall - Scripting</title> <link rel="shortcut icon" href="/sfall-wiki/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/sfall-wiki/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/sfall-wiki/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/sfall-wiki/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.3.0 --> <title>Массивы (Arrays) | sfall - Scripting</title> <meta property="og:title" content="Массивы (Arrays)" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="sfall functions documentation" /> <meta property="og:description" content="sfall functions documentation" /> <link rel="canonical" href="/sfall-wiki/arrays/" /> <meta property="og:url" content="/sfall-wiki/arrays/" /> <meta property="og:site_name" content="sfall - Scripting" /> <script type="application/ld+json"> {"@type":"WebPage","image":null,"url":"/sfall-wiki/arrays/","publisher":null,"author":null,"headline":"Массивы (Arrays)","dateModified":null,"datePublished":null,"sameAs":null,"description":"sfall functions documentation","mainEntityOfPage":null,"name":null,"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png"> <link rel="manifest" href="/assets/favicon/site.webmanifest"> <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/favicon/browserconfig.xml"> <meta name="theme-color" content="#ffffff"> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/sfall-wiki/" class="site-title lh-tight"> sfall - Scripting </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/" class="nav-list-link">Документация</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/data-types/" class="nav-list-link">Типы данных</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="/sfall-wiki/sslc/" class="nav-list-link">Компилятор (sslc)</a></li><li class="nav-list-item "><a href="/sfall-wiki/optimization/" class="nav-list-link">Оптимизация</a></li><li class="nav-list-item "><a href="/sfall-wiki/best-practices/" class="nav-list-link">Практические советы</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/global-scripts/" class="nav-list-link">Глобальные сценарии</a><ul class="nav-list "><li class="nav-list-item "><a href="/sfall-wiki/global-functions/" class="nav-list-link">Функции глобальных скриптов</a></li><li class="nav-list-item "><a href="/sfall-wiki/global-variables/" class="nav-list-link">Функции глобальных переменных</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/arrays/" class="nav-list-link active">Массивы (Arrays)</a><ul class="nav-list "><li class="nav-list-item "><a href="/sfall-wiki/array-functions/" class="nav-list-link">Функции массивов</a></li><li class="nav-list-item "><a href="/sfall-wiki/lists/" class="nav-list-link">Списки (Lists)</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/hooks/" class="nav-list-link">Крючки (Hooks)</a><ul class="nav-list "><li class="nav-list-item "><a href="/sfall-wiki/hook-functions/" class="nav-list-link">Функции крючков</a></li><li class="nav-list-item "><a href="/sfall-wiki/hook-types/" class="nav-list-link">Типы кючков</a></li></ul></li><li class="nav-list-item"><a href="/sfall-wiki/funcx-macros/" class="nav-list-link">FuncX macros</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/script-functions/" class="nav-list-link">Функции скриптов</a><ul class="nav-list "><li class="nav-list-item "><a href="/sfall-wiki/animations/" class="nav-list-link">Animations</a></li><li class="nav-list-item "><a href="/sfall-wiki/art/" class="nav-list-link">Art</a></li><li class="nav-list-item "><a href="/sfall-wiki/car/" class="nav-list-link">Car</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/combat/" class="nav-list-link">Combat</a><ul class="nav-list"><li class="nav-list-item "> <a href="/sfall-wiki/knockback/" class="nav-list-link">Knockback</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/weapons-and-ammo/" class="nav-list-link">Weapons and Ammo</a> </li></ul></li><li class="nav-list-item "><a href="/sfall-wiki/explosions/" class="nav-list-link">Explosions</a></li><li class="nav-list-item "><a href="/sfall-wiki/ini-settings/" class="nav-list-link">INI settings</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/interface/" class="nav-list-link">Interface</a><ul class="nav-list"><li class="nav-list-item "> <a href="/sfall-wiki/cursor/" class="nav-list-link">Cursor</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/inventory/" class="nav-list-link">Inventory</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/main-interface/" class="nav-list-link">Main interface</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/outline/" class="nav-list-link">Outline</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/pip-boy/" class="nav-list-link">Pip-Boy</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/tags/" class="nav-list-link">Tags</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/windows-and-images/" class="nav-list-link">Windows and images</a> </li></ul></li><li class="nav-list-item "><a href="/sfall-wiki/keyboard-and-mouse/" class="nav-list-link">Keyboard and Mouse</a></li><li class="nav-list-item "><a href="/sfall-wiki/locks/" class="nav-list-link">Locks</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/maps-and-encounters/" class="nav-list-link">Maps and Encounters</a><ul class="nav-list"><li class="nav-list-item "> <a href="/sfall-wiki/rest/" class="nav-list-link">Rest</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/worldmap/" class="nav-list-link">Worldmap</a> </li></ul></li><li class="nav-list-item "><a href="/sfall-wiki/maths/" class="nav-list-link">Maths (Математические)</a></li><li class="nav-list-item "><a href="/sfall-wiki/misc/" class="nav-list-link">Misc (Разное)</a></li><li class="nav-list-item "><a href="/sfall-wiki/objects-and-scripts/" class="nav-list-link">Objects and scripts</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/perks-and-traits/" class="nav-list-link">Perks and Traits</a><ul class="nav-list"><li class="nav-list-item "> <a href="/sfall-wiki/npc-perks/" class="nav-list-link">NPC perks</a> </li></ul></li><li class="nav-list-item "><a href="/sfall-wiki/shaders-graphics/" class="nav-list-link">Shaders graphics</a></li><li class="nav-list-item "><a href="/sfall-wiki/skills/" class="nav-list-link">Skills</a></li><li class="nav-list-item "><a href="/sfall-wiki/sound/" class="nav-list-link">Sound</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/stats/" class="nav-list-link">Stats</a><ul class="nav-list"><li class="nav-list-item "> <a href="/sfall-wiki/stats-min-max/" class="nav-list-link">Stats min/max</a> </li></ul></li><li class="nav-list-item "><a href="/sfall-wiki/strings/" class="nav-list-link">Strings</a></li><li class="nav-list-item "><a href="/sfall-wiki/tiles-and-paths/" class="nav-list-link">Tiles and Paths</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/system-functions/" class="nav-list-link">Системные функции</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/sfall-wiki/direct-memory-access/" class="nav-list-link">Direct memory access</a><ul class="nav-list"><li class="nav-list-item "> <a href="/sfall-wiki/calls/" class="nav-list-link">Calls</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/read/" class="nav-list-link">Read</a> </li><li class="nav-list-item "> <a href="/sfall-wiki/write/" class="nav-list-link">Write</a> </li></ul></li><li class="nav-list-item "><a href="/sfall-wiki/funcx-metarule/" class="nav-list-link">FuncX metarule</a></li><li class="nav-list-item "><a href="/sfall-wiki/others/" class="nav-list-link">Others</a></li><li class="nav-list-item "><a href="/sfall-wiki/sfall-version/" class="nav-list-link">Sfall version</a></li><li class="nav-list-item "><a href="/sfall-wiki/virtual-file-system/" class="nav-list-link">Virtual file system</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search sfall - Scripting" aria-label="Search sfall - Scripting" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://nma-fallout.com/threads/fo2-engine-tweaks-sfall.178390/" class="site-button" > Forum </a> </li> <li class="aux-nav-list-item"> <a href="https://github.com/FakelsHub/sFall-Extended" class="site-button" > GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="массивы"> <a href="#массивы" class="anchor-heading" aria-labelledby="массивы"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Массивы </h1> <p>Sfall вводит новый метод хранения переменных - массивы.</p> <p>Массив - это в основном контейнер, в котором может храниться переменное количество значений (элементов). Каждый элемент в массиве может быть любого типа. Массивы могут быть чрезвычайно полезны для некоторых более сложных сценариев в сочетании с циклами.<br /></p> <p>Описание функций массивов <a href="/sfall-wiki/array-functions/">здесь</a>.</p> <ul id="markdown-toc"> <li><a href="#концепция-массивов" id="markdown-toc-концепция-массивов">Концепция массивов</a></li> <li><a href="#синтаксис-массивов" id="markdown-toc-синтаксис-массивов">Синтаксис массивов</a></li> <li><a href="#хранение-массивов" id="markdown-toc-хранение-массивов">Хранение массивов</a></li> <li><a href="#практические-примеры" id="markdown-toc-практические-примеры">Практические примеры</a></li> <li><a href="#примечания-по-обратной-совместимости" id="markdown-toc-примечания-по-обратной-совместимости">Примечания по обратной совместимости</a></li> <li><a href="#array-operators-reference" id="markdown-toc-array-operators-reference">Array operators reference</a></li> </ul><hr /> <h2 id="концепция-массивов"> <a href="#концепция-массивов" class="anchor-heading" aria-labelledby="концепция-массивов"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Концепция массивов </h2> <p>Массивы создаются и управляются с помощью функций массива. Для начала массив должен быть создан с помощью функций <code class="highlighter-rouge">create_array</code> или <code class="highlighter-rouge">temp_array</code>, указав, сколько элементов данных может содержать массив. Вы можете хранить любые типы данных <code class="highlighter-rouge">int</code>, <code class="highlighter-rouge">float</code> или <code class="highlighter-rouge">string</code> в массиве, также можно смешивать все 3 типа в одном массиве.<br /> Идентификатор массива, возвращаемый функциями <code class="highlighter-rouge">create_array</code> или <code class="highlighter-rouge">temp_array</code>, может использоваться в других функциях для доступа к созданному массиву. Массивы являются общими для всех сценариев (т.е. вы можете вызвать <code class="highlighter-rouge">create_array</code> в одном сценарии, а затем использовать возвращенный идентификатор в совершенно другом сценарии для доступа к массиву). Массивы также могут быть сохранены в файлах сохранения игры.</p> <p>Массивы, созданные с помощью <code class="highlighter-rouge">temp_array</code>, будут автоматически удалены в конце кадра выполнения сценария. <code class="highlighter-rouge">create_array</code> - единственная функция, которая возвращает постоянный массив, все остальные функции, возвращающие массивы (<code class="highlighter-rouge">string_split</code>, <code class="highlighter-rouge">list_as_array</code> и т.д.), создают временные массивы. Вы можете использовать функцию <code class="highlighter-rouge">fix_array</code>, чтобы сделать временный массив постоянным.<br /> Функции массивов полностью безопасны в том смысле, что использование неверного идентификатора или попытки доступа к элементам вне размера массива не приведут к сбою в сценарии.</p> <p>Доступ к элементам массива осуществляется по индексу или ключу.</p> <p><em>Пример:</em></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// this code puts some string in array "list" at index 5:</span>
    <span class="nx">list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="p">:</span><span class="o">=</span> <span class="s2">"Value"</span><span class="p">;</span>
</code></pre></div></div> <p>В настоящее время доступно 2 различных типа массива:</p> <ol> <li> <p><strong>Lists</strong> - предоставляет коллекцию значений, определенного размера (количество элементов), где элементы имеют числовые индексы, первый индекс элемента всегда начинается с нуля (0) до конца всей длины массива минус единица.</p> <p><em>Пример:</em></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// this creates list with 3 elements. Element "A" has index 0, element "B" has index 1, element "C" - 2</span>
 <span class="nx">list</span> <span class="p">:</span><span class="o">=</span> <span class="p">[</span><span class="s2">"A"</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">,</span> <span class="s2">"C"</span><span class="p">];</span>
</code></pre></div> </div> <p>Ограничения:</p> <ul> <li>все индексы являются числовыми, и начинаются с 0</li> <li>чтобы присвоить значение элементу списка по определенному индексу, необходимо для сначала изменить размер массива, чтобы список содержал этот индекс<br /> например, если список имеет размер 3 (индексы от 0 до 2), вы не можете присвоить значение по индексу 4, если сначала не измените размер списка на 5</li> </ul> </li> <li> <p><strong>Maps</strong> - ассоциативные массивы содержат наборы пар <strong>key=&gt;value</strong>, где все элементы (значения) доступны с помощью соответствующих ключей.</p> <p>Отличия Maps (карт) от List (списка):</p> <ul> <li>ассоциативные массивы не имеют определенного размера (для присвоения значений вам не нужно изменять размер массива)</li> <li>ключи, как и значения, могут быть любого типа (но избегайте использования -1 в качестве ключей массива, иначе вы не сможете надежно использовать некоторые функции)</li> </ul> </li> </ol> <p>Оба типа массива имеют свои плюсы и минусы и подходят для решения различных задач.</p><hr /> <h2 id="синтаксис-массивов"> <a href="#синтаксис-массивов" class="anchor-heading" aria-labelledby="синтаксис-массивов"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Синтаксис массивов </h2> <p>В основном массивы реализуются с использованием ряда новых операторов (функций сценариев). Но для удобства использования есть некоторые новые элементы синтаксиса:</p> <ol> <li>Доступ к элементам. Используйте квадратные скобки: <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">display_msg</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
 <span class="nx">mymap</span><span class="p">[</span><span class="s2">"price"</span><span class="p">]</span> <span class="p">:</span><span class="o">=</span> <span class="mf">515.23</span><span class="p">;</span>
</code></pre></div> </div> </li> <li>Альтернативный доступ к картам. Используйте точку: <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">display_msg</span><span class="p">(</span><span class="nx">mymap</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
 <span class="nx">mymap</span><span class="p">.</span><span class="nx">price</span> <span class="p">:</span><span class="o">=</span> <span class="mf">232.23</span><span class="p">;</span>
</code></pre></div> </div> </li> <li>Выражения массива. Создавайте и заполняйте массивы просто используя одно выражение: <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// create list with 5 values</span>
 <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">777</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="s2">"Cool Value"</span><span class="p">]</span>

 <span class="c1">// create map:</span>
 <span class="p">{</span><span class="mi">5</span><span class="p">:</span> <span class="s2">"Five"</span><span class="p">,</span> <span class="s2">"health"</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">"speed"</span><span class="p">:</span> <span class="mf">0.252</span><span class="p">}</span>
</code></pre></div> </div> <p><strong>NOTES:</strong> Обязательно вызовите <code class="highlighter-rouge">fix_array</code>, если вы хотите, чтобы новый массив был доступен в следующем фрейме выполнения сценария, или <code class="highlighter-rouge">save_array</code>, если вы хотите использовать его в течение более длительного периода (подробнее см. следующий раздел).</p> </li> <li>Перебор элементов массива в цикле. Используйте ключевое слово <code class="highlighter-rouge">foreach</code> следующим образом: <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">foreach</span> <span class="p">(</span><span class="nx">item</span> <span class="k">in</span> <span class="nx">myarray</span><span class="p">)</span> <span class="nx">begin</span>
     <span class="c1">// этот блок выполняется для каждого элемента массива, где "item" содержит текущее значение на каждом шаге итерации</span>
 <span class="nx">end</span>

 <span class="c1">// альтернативный синтаксис:</span>
 <span class="nx">foreach</span> <span class="p">(</span><span class="nx">key</span><span class="p">:</span> <span class="nx">item</span> <span class="k">in</span> <span class="nx">myarray</span><span class="p">)</span> <span class="nx">begin</span>
     <span class="c1">// "key" будет содержать текущий ключ (или числовой индекс, для списков)</span>
 <span class="nx">end</span>
</code></pre></div> </div> </li> </ol> <p>См.: <strong>sslc_readme.md</strong> файл для получения полной информации о новых функциях синтаксиса SSL.</p><hr /> <h2 id="хранение-массивов"> <a href="#хранение-массивов" class="anchor-heading" aria-labelledby="хранение-массивов"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Хранение массивов </h2> <p>Часть массивов списков и карт разделена по способу их хранения.</p> <p>Существует 3 типа массивов:</p> <ul> <li> <p><strong>Temporary</strong>: Они создаются с помощью функции <code class="highlighter-rouge">temp_array</code> или при использовании выражений массива. Массивы этого типа автоматически удаляются в конце кадра выполнения сценария. Так, например, если у вас есть глобальный сценарий, который выполняется через регулярные промежутки времени, где вы создаете <code class="highlighter-rouge">temp_array</code>, то массив не будет доступен при следующем выполнении вашего глобального сценария.</p> </li> <li> <p><strong>Permanent</strong>: Они создаются с помощью функций <code class="highlighter-rouge">create_array</code> или <code class="highlighter-rouge">fix_array</code> (из уже существующего временного массива). Массивы этого типа всегда доступны (по их идентификатору) до тех пор, пока вы не начнете новую игру или не загрузите сохраненную игру (после чего они будут удалены).</p> </li> <li> <p><strong>Saved</strong>: Если вы хотите, чтобы ваш массив действительно оставался на некоторое время, используйте функцию <code class="highlighter-rouge">save_array</code>, чтобы сделать любой массив “сохраняемым”. Однако они, как и постоянные массивы, “удаляются” из памяти при загрузке игры. Чтобы правильно их использовать, вы должны загружать их из сохраненной игры с помощью “load_array” всякий раз, когда вы хотите их использовать.<br /> <em>Пример:</em></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">variable</span> <span class="nx">savedArray</span><span class="p">;</span>
  <span class="nx">procedure</span> <span class="nx">start</span> <span class="nx">begin</span>
      <span class="k">if</span> <span class="nx">game_loaded</span> <span class="nx">then</span> <span class="nx">begin</span>
          <span class="nx">savedArray</span> <span class="p">:</span><span class="o">=</span> <span class="nx">load_array</span><span class="p">(</span><span class="s2">"traps"</span><span class="p">);</span>
      <span class="nx">end</span> <span class="k">else</span> <span class="nx">begin</span>
          <span class="nx">foreach</span> <span class="nx">trap</span> <span class="k">in</span> <span class="nx">traps</span> <span class="nx">begin</span>
              <span class="p">....</span>
          <span class="nx">end</span>
      <span class="nx">end</span>
  <span class="nx">end</span>
</code></pre></div> </div><hr /> <h2 id="практические-примеры"> <a href="#практические-примеры" class="anchor-heading" aria-labelledby="практические-примеры"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Практические примеры </h2> </li> </ul> <p><strong>Используйте массивы для реализации процедур с переменными аргументами:</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// define it</span>
    <span class="nx">procedure</span> <span class="nx">give_item</span><span class="p">(</span><span class="nx">variable</span> <span class="nx">critter</span><span class="p">,</span> <span class="nx">variable</span> <span class="nx">pidList</span><span class="p">)</span> <span class="nx">begin</span>
        <span class="nx">foreach</span> <span class="p">(</span><span class="nx">pid</span><span class="p">:</span> <span class="nx">qty</span> <span class="k">in</span> <span class="nx">pidList</span><span class="p">)</span> <span class="nx">begin</span>
            <span class="nx">give_pid_qty</span><span class="p">(</span><span class="nx">critter</span><span class="p">,</span> <span class="nx">pid</span><span class="p">,</span> <span class="nx">qty</span><span class="p">);</span>
        <span class="nx">end</span>
    <span class="nx">end</span>

    <span class="c1">// call it:</span>
    <span class="nx">call</span> <span class="nx">give_item</span><span class="p">(</span><span class="nx">dude_obj</span><span class="p">,</span> <span class="p">{</span><span class="na">PID_SHOTGUN</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">PID_SHOTGUN_SHELLS</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="na">PID_STIMPAK</span><span class="p">:</span> <span class="mi">3</span><span class="p">});</span>
</code></pre></div></div> <p><strong>Создание массивов объектов (карт) для продвинутого скриптинга:</strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">variable</span> <span class="nx">traps</span><span class="p">;</span>
    <span class="nx">procedure</span> <span class="nx">init_traps</span> <span class="nx">begin</span>
        <span class="c1">// just a quick example, there is a better way of doing it...</span>
        <span class="nx">traps</span> <span class="p">:</span><span class="o">=</span> <span class="nx">load_array</span><span class="p">(</span><span class="s2">"traps"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">traps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">then</span> <span class="nx">begin</span>
            <span class="nx">traps</span> <span class="p">:</span><span class="o">=</span> <span class="p">[];</span>
            <span class="nx">save_array</span><span class="p">(</span><span class="s2">"traps"</span><span class="p">,</span> <span class="nx">traps</span><span class="p">);</span>
        <span class="nx">end</span>
        <span class="nx">foreach</span> <span class="nx">k</span><span class="p">:</span> <span class="nx">v</span> <span class="k">in</span> <span class="nx">traps</span> <span class="nx">begin</span>
            <span class="nx">traps</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="p">:</span><span class="o">=</span> <span class="nx">load_array</span><span class="p">(</span><span class="s2">"trap_"</span><span class="o">+</span><span class="nx">k</span><span class="p">);</span> <span class="c1">// каждый объект хранится отдельно</span>
        <span class="nx">end</span>
    <span class="nx">end</span>

    <span class="nx">procedure</span> <span class="nx">add_trap</span><span class="p">(</span><span class="nx">variable</span> <span class="nx">trapArray</span><span class="p">)</span> <span class="nx">begin</span>
        <span class="nx">variable</span> <span class="nx">index</span><span class="p">;</span>
        <span class="nl">index</span> <span class="p">:</span><span class="o">=</span> <span class="nx">len_array</span><span class="p">(</span><span class="nx">traps</span><span class="p">);</span>
        <span class="nx">save_array</span><span class="p">(</span><span class="s2">"trap_"</span><span class="o">+</span><span class="nx">k</span><span class="p">,</span> <span class="nx">trapArray</span><span class="p">);</span>
        <span class="nx">array_push</span><span class="p">(</span><span class="nx">traps</span><span class="p">,</span> <span class="nx">trapArray</span><span class="p">);</span>
    <span class="nx">end</span>

    <span class="c1">// use them:</span>
    <span class="nx">foreach</span> <span class="nx">trap</span> <span class="k">in</span> <span class="nx">traps</span> <span class="nx">begin</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self_elevation</span> <span class="o">==</span> <span class="nx">trap</span><span class="p">[</span><span class="s2">"elev"</span><span class="p">]</span> <span class="nx">and</span> <span class="nx">tile_distance</span><span class="p">(</span><span class="nx">self_tile</span><span class="p">,</span> <span class="nx">trap</span><span class="p">[</span><span class="s2">"tile"</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nx">trap</span><span class="p">[</span><span class="s2">"radius"</span><span class="p">])</span> <span class="nx">then</span>
            <span class="c1">// kaboom!!!</span>
        <span class="nx">end</span>
    <span class="nx">end</span>
</code></pre></div></div><hr /> <h2 id="примечания-по-обратной-совместимости"> <a href="#примечания-по-обратной-совместимости" class="anchor-heading" aria-labelledby="примечания-по-обратной-совместимости"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Примечания по обратной совместимости </h2> <p>Для тех, кто использовал массивы в своих модах до sfall 3.4:</p> <ol> <li> <p>Существует INI параметр <strong>ArraysBehavior</strong> в <strong>Misc</strong> разделе файла “ddraw.ini”. Если его значение установлено в 0, то все сценарии, которые ранее использовали массивы sfall, должны работать. Это в основном меняет то, что <code class="highlighter-rouge">create_array</code> создает постоянные массивы, которые “сохраняются” по умолчанию, и их идентификатор также является постоянным. По умолчанию этот параметр равен 1.</p> </li> <li> <p>Как обрабатывается совместимость с сохраненными играми?.<br /> Сохраненные массивы хранятся в файле <strong>sfallgv.sav</strong> (в сохраненной игре) в новом (более гибком) формате сразу после старых массивов. Таким образом, в принципе, когда вы загружаете старую сохраненную игру, sfall загрузит массивы из старого формата и сохранит их в новом формате при следующем сохранении игры. Если вы загрузите сохраненную игру, созданную с помощью sfall 3.4, используя sfall 3.3 (например), игра не должна завершиться сбоем, но все массивы будут потеряны.</p> </li> <li> <p>Ранее вам приходилось указывать размер в байтах для элементов массива. Этот параметр теперь игнорируется, и вы можете хранить строки произвольной длины в массивах.</p> </li> </ol> <h2 id="array-operators-reference"> <a href="#array-operators-reference" class="anchor-heading" aria-labelledby="array-operators-reference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Array operators reference </h2> <p><em>*mixed means any type</em></p> <ul> <li><code class="highlighter-rouge">int create_array(int size, int flags)</code>: <ul> <li>creates permanent array (but not “saved”)</li> <li>if <code class="highlighter-rouge">size &gt;= 0</code>, creates list with given size</li> <li>if <code class="highlighter-rouge">size == -1</code>, creates map (associative array)</li> <li>if <code class="highlighter-rouge">size == -1</code> and <code class="highlighter-rouge">flags == 2</code>, creates a “lookup” map (associative array) in which the values of existing keys are read-only and can’t be updated. This type of array allows you to store a zero (0) key value <ul> <li>NOTE: in earlier versions (up to 4.1.3/3.8.13) the second argument is not used, just use 0</li> </ul> </li> <li>returns arrayID (valid until array is deleted)</li> </ul> </li> <li><code class="highlighter-rouge">int temp_array(int size, int flags)</code>: <ul> <li>works exactly like <code class="highlighter-rouge">create_array</code>, only created array becomes “temporary”</li> </ul> </li> <li><code class="highlighter-rouge">void fix_array(int arrayID)</code>: <ul> <li>changes “temporary” array into “permanent” (“permanent” arrays are not automatically saved into savegames)</li> </ul> </li> <li><code class="highlighter-rouge">void set_array(int arrayID, mixed key, mixed value)</code>: <ul> <li>sets array value</li> <li>if used on list, “key” must be numeric and within valid index range (0..size-1)</li> <li>if used on map, key can be of any type</li> <li>to “unset” a value from map, just set it to zero (0) <ul> <li>NOTE: to add a value of 0 for the key, use the float value of 0.0</li> </ul> </li> <li>this works exactly like statement: <code class="highlighter-rouge">arrayID[key] := value;</code></li> </ul> </li> <li><code class="highlighter-rouge">mixed get_array(int arrayID, mixed key)</code>: <ul> <li>returns array value by key or index</li> <li>if key doesn’t exist or index is not in valid range, returns 0</li> <li>works exactly like expression: <code class="highlighter-rouge">(arrayID[key])</code></li> </ul> </li> <li><code class="highlighter-rouge">void resize_array(int arrayID, int size)</code>: <ul> <li>changes array size</li> <li>applicable to maps too, but only to reduce elements</li> <li>there are number of special negative values of “size” which perform various operations on the array, use macros <code class="highlighter-rouge">sort_array</code>, <code class="highlighter-rouge">sort_array_reverse</code>, <code class="highlighter-rouge">reverse_array</code>, <code class="highlighter-rouge">shuffle_array</code> from <strong>sfall.h</strong> header</li> </ul> </li> <li><code class="highlighter-rouge">void free_array(int arrayID)</code>: <ul> <li>deletes any array</li> <li>if array was “saved”, it will be removed from a savegame</li> </ul> </li> <li><code class="highlighter-rouge">mixed scan_array(int arrayID, mixed value)</code>: <ul> <li>searches for a first occurence of given value inside given array</li> <li>if value is found, returns it’s index (for lists) or key (for maps)</li> <li>if value is not found, returns -1 (be careful, as -1 can be a valid key for a map)</li> </ul> </li> <li><code class="highlighter-rouge">int len_array(int arrayID)</code>: <ul> <li>returns number of elements or key=&gt;value pairs in a given array</li> <li>if array is not found, returns -1 (can be used to check if given array exist)</li> </ul> </li> <li><code class="highlighter-rouge">mixed array_key(int arrayID, int index)</code>: <ul> <li>don’t use it directly; it is generated by the compiler in foreach loops</li> <li>for lists, returns index back (no change)</li> <li>for maps, returns a key at the specified numeric index (don’t rely on the order in which keys are stored though)</li> <li>can be checked if given array is associative or not, by using index (-1): 0 - array is list, 1 - array is map</li> </ul> </li> <li><code class="highlighter-rouge">int arrayexpr(mixed key, mixed value)</code>: <ul> <li>don’t use it directly; it is used by compiler to create array expressions</li> <li>assigns value to a given key in an array, created by last <code class="highlighter-rouge">create_array</code> or <code class="highlighter-rouge">temp_array</code> call</li> <li>always returns 0</li> </ul> </li> <li><code class="highlighter-rouge">void save_array(mixed key, int arrayID)</code>: <ul> <li>makes the array saveable; it will be saved in <strong>sfallgv.sav</strong> file when saving the game</li> <li>arrayID is associated with given “key”</li> <li>array becomes permanent (if it was temporary) and “saved”</li> <li>key can be of any type (int, float or string)</li> <li>if you specify 0 as the key for the array ID, it will make the array “unsaved”</li> </ul> </li> <li><code class="highlighter-rouge">int load_array(mixed key)</code>: <ul> <li>loads array from savegame data by the same key provided in <code class="highlighter-rouge">save_array</code></li> <li>returns array ID or zero (0) if none found</li> </ul> </li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
